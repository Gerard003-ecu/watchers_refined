<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Interactivo: Unidad de Potencia Inteligente (IPU)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony (Background: Slate-50, Text: Slate-800, Accents: Teal, Amber) -->
    <!-- Application Structure Plan: The SPA uses a tabbed, non-linear dashboard structure with four main sections: 'Inicio' (introduction), 'El N√∫cleo: La IPU' (core concept), 'Componentes Clave' (interactive deep-dive), and 'Desaf√≠os y Futuro' (conclusion). This thematic structure was chosen over a linear report layout to enhance user engagement and allow for self-directed exploration. Users can quickly grasp the main concept (IPU) and then dive into specific components (Power, Control, Storage) based on their interest, facilitated by interactive charts and diagrams. This approach transforms the dense report into an intuitive learning tool. -->
    <!-- Visualization & Content Choices: 
    - Report Info: Battery Technology Comparison (Table 3). Goal: Compare multiple metrics. Viz/Presentation: Interactive Bar Chart (Chart.js). Interaction: Click on a battery type's bar to display detailed text info (pros/cons/suitability). Justification: Visually comparing multiple quantitative metrics is faster than reading a table. The click interaction allows for progressive disclosure of qualitative information, reducing initial cognitive load.
    - Report Info: Power Electronics Components (Table 1). Goal: Compare efficiency and features. Viz/Presentation: Bar Chart + Filterable Cards. Interaction: Buttons to filter components, updating the chart and displaying a relevant info card. Justification: This allows direct comparison of a key metric (efficiency) while providing detailed qualitative info on demand.
    - Report Info: IPU Architecture. Goal: Explain system structure. Viz/Presentation: HTML/CSS Diagram. Interaction: Hover over blocks to show tooltips with descriptions. Justification: An interactive diagram is more engaging than a static image and keeps the UI clean by hiding details until requested.
    - Report Info: Atomic Piston Analogy. Goal: Explain a core concept simply. Viz/Presentation: Simple CSS/JS animation. Interaction: None (automatic loop). Justification: Animation demonstrates the dynamic concepts (charge/discharge, kickback) more effectively than static text.
    - Library/Method: All charts use Chart.js on Canvas. All diagrams use HTML/CSS with Tailwind. Interactions are powered by vanilla JavaScript. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
            color: #1e293b; /* slate-800 */
        }
        .nav-link {
            transition: color 0.3s, border-bottom-color 0.3s;
            border-bottom: 2px solid transparent;
        }
        .nav-link.active {
            color: #0d9488; /* teal-600 */
            border-bottom-color: #0d9488; /* teal-600 */
        }
        .nav-link:hover {
            color: #0d9488; /* teal-600 */
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 45vh;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .component-btn {
            transition: background-color 0.3s, color 0.3s;
        }
        .component-btn.active {
            background-color: #0d9488; /* teal-600 */
            color: white;
        }
        .tooltip {
            position: absolute;
            display: none;
            background-color: #1e293b;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.875rem;
            z-index: 10;
            pointer-events: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .diagram-block {
            position: relative;
            cursor: pointer;
        }
        .piston-animation div {
            transition: all 0.5s ease-in-out;
        }
        .capacitor-bar {
            width: 0%;
            transition: width 1.5s linear;
        }
        .kickback-spark {
            opacity: 0;
            transition: opacity 0.2s;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-20">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl md:text-2xl font-bold text-teal-700">Unidad de Potencia Inteligente (IPU)</h1>
                </div>
                <nav class="hidden md:flex md:space-x-8">
                    <a href="#inicio" class="nav-link font-medium text-slate-600 active">Inicio</a>
                    <a href="#ipu" class="nav-link font-medium text-slate-600">El N√∫cleo: La IPU</a>
                    <a href="#componentes" class="nav-link font-medium text-slate-600">Componentes Clave</a>
                    <a href="#desafios" class="nav-link font-medium text-slate-600">Desaf√≠os y Futuro</a>
                </nav>
                 <button id="mobile-menu-button" class="md:hidden inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white">
                    <span class="sr-only">Abrir men√∫ principal</span>
                    <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                    </svg>
                </button>
            </div>
        </div>
        <div id="mobile-menu" class="md:hidden hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#inicio" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-slate-600">Inicio</a>
                <a href="#ipu" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-slate-600">El N√∫cleo: La IPU</a>
                <a href="#componentes" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-slate-600">Componentes Clave</a>
                <a href="#desafios" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-slate-600">Desaf√≠os y Futuro</a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">

        <section id="inicio" class="content-section active">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-800 mb-4">Transformando la Energ√≠a Solar con Inteligencia</h2>
                <p class="max-w-3xl mx-auto text-lg text-slate-600">
                    Esta aplicaci√≥n explora el concepto de una Unidad de Potencia Inteligente (IPU), un sistema avanzado dise√±ado para revolucionar la gesti√≥n de energ√≠a en sistemas fotovoltaicos. Descubra c√≥mo la combinaci√≥n de electr√≥nica de potencia, control por microprocesador y bater√≠as eficientes puede crear un "flujo de energ√≠a adicional", permitiendo una respuesta r√°pida y potente a las demandas energ√©ticas.
                </p>
            </div>

            <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border border-slate-200">
                 <h3 class="text-2xl font-bold text-center text-teal-700 mb-6">El Flujo de Energ√≠a en un Sistema Fotovoltaico Moderno</h3>
                <div class="grid grid-cols-1 md:grid-cols-5 items-center gap-4 md:gap-6 text-center">
                    <div class="flex flex-col items-center">
                        <div class="text-4xl mb-2">‚òÄÔ∏è</div>
                        <h4 class="font-semibold text-slate-700">Paneles Solares</h4>
                        <p class="text-sm text-slate-500">Generan energ√≠a CC</p>
                    </div>
                    <div class="text-4xl text-slate-300 transform md:rotate-0 rotate-90">‚Üí</div>
                    <div class="flex flex-col items-center">
                        <div class="text-4xl mb-2">‚öôÔ∏è</div>
                        <h4 class="font-semibold text-slate-700">Unidad de Potencia Inteligente (IPU)</h4>
                        <p class="text-sm text-slate-500">Gestiona, almacena y optimiza</p>
                    </div>
                    <div class="text-4xl text-slate-300 transform md:rotate-0 rotate-90">‚Üí</div>
                    <div class="flex flex-col items-center">
                        <div class="text-4xl mb-2">üè† / üåê</div>
                        <h4 class="font-semibold text-slate-700">Hogar y Red El√©ctrica</h4>
                        <p class="text-sm text-slate-500">Consumo de energ√≠a CA</p>
                    </div>
                </div>
                 <p class="mt-8 text-center text-slate-600 max-w-4xl mx-auto">
                    La IPU act√∫a como el coraz√≥n y cerebro del sistema, no solo convirtiendo y almacenando energ√≠a, sino gestion√°ndola activamente para maximizar la eficiencia (hasta 98%), proteger los componentes y proporcionar r√°fagas de potencia cuando es necesario, estabilizando as√≠ el suministro y la red.
                </p>
            </div>
        </section>

        <section id="ipu" class="content-section">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-800 mb-4">El N√∫cleo: La Unidad de Potencia Inteligente (IPU)</h2>
                <p class="max-w-3xl mx-auto text-lg text-slate-600">
                    La IPU se inspira en la analog√≠a del "pist√≥n at√≥mico" para describir un sistema que almacena energ√≠a de forma eficiente y la libera en pulsos r√°pidos y potentes. Esto se logra mediante la combinaci√≥n inteligente de condensadores e inductores.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                    <h3 class="text-xl font-bold text-teal-700 mb-4 text-center">Analog√≠a del Pist√≥n: Capacitor e Inductor</h3>
                    <div class="piston-animation space-y-6">
                        <div>
                            <h4 class="font-semibold mb-2">1. El Capacitor: Descarga Instant√°nea ‚ö°</h4>
                            <p class="text-sm text-slate-600 mb-2">Almacena energ√≠a en un campo el√©ctrico y la libera de golpe, como un resorte comprimido.</p>
                            <div class="w-full bg-slate-200 rounded-full h-6">
                                <div id="capacitor-bar" class="capacitor-bar bg-amber-400 h-6 rounded-full text-right pr-2 text-xs font-medium text-amber-800 flex items-center justify-end"></div>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">2. El Inductor: "Retroceso Inductivo" üí•</h4>
                            <p class="text-sm text-slate-600 mb-2">Almacena energ√≠a en un campo magn√©tico. Al cortar la corriente, genera un pico masivo de voltaje.</p>
                            <div class="flex items-center space-x-4">
                                <span class="text-2xl">üîå</span>
                                <div class="w-full bg-slate-200 rounded-full h-2 relative">
                                    <div id="inductor-flow" class="absolute top-0 left-0 h-full bg-sky-500 rounded-full" style="width: 100%;"></div>
                                </div>
                                <span id="kickback-spark" class="text-3xl kickback-spark">üî•</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                    <h3 class="text-xl font-bold text-teal-700 mb-4 text-center">Arquitectura de la IPU</h3>
                     <p class="text-sm text-slate-600 mb-4 text-center">
                        Pase el cursor sobre cada bloque para ver su funci√≥n. La IPU integra m√∫ltiples componentes para orquestar el flujo de energ√≠a de manera inteligente.
                    </p>
                    <div class="grid grid-cols-3 gap-2 text-center text-xs font-medium">
                        <div class="col-span-3 diagram-block bg-amber-100 text-amber-800 p-3 rounded-lg" data-tooltip="Fuente de energ√≠a primaria que genera corriente continua (CC) a partir de la luz solar.">‚òÄÔ∏è Paneles Solares</div>
                        <div class="col-span-3 flex justify-center"><div class="h-4 w-px bg-slate-300"></div></div>
                        <div class="col-span-3 diagram-block bg-slate-200 text-slate-800 p-4 rounded-lg" data-tooltip="Optimiza la energ√≠a de los paneles (MPPT) y regula el voltaje para su almacenamiento y uso eficiente.">‚öôÔ∏è Convertidor CC-CC (con MPPT)</div>
                        <div class="col-span-3 flex justify-center"><div class="h-4 w-px bg-slate-300"></div></div>
                        
                        <div class="diagram-block bg-green-100 text-green-800 p-3 rounded-lg" data-tooltip="Almacena grandes cantidades de energ√≠a a largo plazo. Las bater√≠as LiFePO4 son ideales por su seguridad y vida √∫til.">üîã Bater√≠a Principal (LiFePO4)</div>
                        <div class="diagram-block bg-teal-100 text-teal-800 p-3 rounded-lg" data-tooltip="El cerebro del sistema. Ejecuta algoritmos (MPPT, BMS, control de pulsos) y gestiona la comunicaci√≥n.">üß† Microcontrolador (ESP32)</div>
                        <div class="diagram-block bg-sky-100 text-sky-800 p-3 rounded-lg" data-tooltip="Almacena y libera energ√≠a muy r√°pidamente para los pulsos de alta potencia.">‚ö° M√≥dulo de Potencia Pulsada (Supercapacitor + Inductor)</div>

                        <div class="col-span-3 flex justify-center"><div class="h-4 w-px bg-slate-300"></div></div>
                        <div class="col-span-3 diagram-block bg-purple-100 text-purple-800 p-4 rounded-lg" data-tooltip="Convierte la energ√≠a CC a CA para el uso en el hogar o para inyectarla a la red el√©ctrica.">üîå Inversor / Carga</div>
                    </div>
                </div>
            </div>
             <div id="tooltip" class="tooltip"></div>
        </section>

        <section id="componentes" class="content-section">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-800 mb-4">Componentes Clave de la IPU</h2>
                <p class="max-w-3xl mx-auto text-lg text-slate-600">
                    La funcionalidad de la IPU depende de la perfecta integraci√≥n de tres categor√≠as de componentes: la gesti√≥n de la potencia, el control inteligente y el almacenamiento eficiente de la energ√≠a.
                </p>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                    <h3 class="text-xl font-bold text-teal-700 mb-4">Gesti√≥n de Potencia: El M√∫sculo</h3>
                    <p class="text-slate-600 mb-4">Estos componentes manejan el flujo de energ√≠a. Su eficiencia es crucial para minimizar p√©rdidas. Seleccione un componente para ver sus detalles y comparar su eficiencia t√≠pica.</p>
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button class="component-btn active bg-slate-200 px-3 py-1 rounded-full text-sm font-medium" data-component="inversor">Inversores</button>
                        <button class="component-btn bg-slate-200 px-3 py-1 rounded-full text-sm font-medium" data-component="controlador">Controladores de Carga</button>
                        <button class="component-btn bg-slate-200 px-3 py-1 rounded-full text-sm font-medium" data-component="convertidor">Convertidores CC-CC</button>
                    </div>
                    <div id="component-details" class="bg-slate-50 p-4 rounded-lg mb-4">
                        <!-- Detalles se llenan con JS -->
                    </div>
                    <div class="chart-container h-64 md:h-72">
                        <canvas id="efficiencyChart"></canvas>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                    <h3 class="text-xl font-bold text-teal-700 mb-4">Control Inteligente: El Cerebro</h3>
                     <p class="text-slate-600 mb-4">Los microcontroladores ejecutan los algoritmos que optimizan el rendimiento y garantizan la seguridad. El ESP32 es un candidato ideal por su potencia y versatilidad.</p>
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <h4 class="font-bold text-slate-800 mb-2">ESP32: Capacidades Clave</h4>
                        <ul class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-slate-600">
                            <li class="flex items-center">
                                <span class="mr-2 text-teal-600">‚öôÔ∏è</span>
                                <span>CPU Dual-Core @ 240MHz</span>
                            </li>
                            <li class="flex items-center">
                                <span class="mr-2 text-teal-600">üì∂</span>
                                <span>Wi-Fi y Bluetooth</span>
                            </li>
                             <li class="flex items-center">
                                <span class="mr-2 text-teal-600">üîå</span>
                                <span>34 GPIOs programables</span>
                            </li>
                             <li class="flex items-center">
                                <span class="mr-2 text-teal-600">‚ö°</span>
                                <span>Modos de bajo consumo</span>
                            </li>
                             <li class="flex items-center">
                                <span class="mr-2 text-teal-600">üîí</span>
                                <span>Seguridad por hardware</span>
                            </li>
                             <li class="flex items-center">
                                <span class="mr-2 text-teal-600">üìà</span>
                                <span>ADC 12-bit y PWM</span>
                            </li>
                        </ul>
                         <p class="text-xs text-slate-500 mt-4">Estas caracter√≠sticas permiten al ESP32 ejecutar algoritmos complejos como MPPT y BMS, controlar con precisi√≥n los semiconductores de potencia y comunicarse de forma remota, todo con un consumo de energ√≠a m√≠nimo.</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border border-slate-200">
                <h3 class="text-2xl font-bold text-teal-700 mb-2 text-center">Almacenamiento de Energ√≠a: La Reserva</h3>
                <p class="text-slate-600 mb-6 text-center max-w-3xl mx-auto">La elecci√≥n de la bater√≠a impacta directamente en la eficiencia, vida √∫til y seguridad del sistema. Haga clic en una barra para explorar las caracter√≠sticas de cada tecnolog√≠a.</p>
                 <div class="grid grid-cols-1 lg:grid-cols-5 gap-8 items-center">
                    <div class="lg:col-span-3">
                        <div class="chart-container">
                             <canvas id="batteryChart"></canvas>
                        </div>
                    </div>
                    <div id="battery-details" class="lg:col-span-2 bg-slate-50 p-4 rounded-lg">
                       <!-- Detalles de la bater√≠a se llenan con JS -->
                    </div>
                 </div>
            </div>
        </section>

        <section id="desafios" class="content-section">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-800 mb-4">Desaf√≠os y Oportunidades Futuras</h2>
                <p class="max-w-3xl mx-auto text-lg text-slate-600">
                    El desarrollo de la IPU presenta tanto obst√°culos de ingenier√≠a como un enorme potencial para transformar nuestros sistemas energ√©ticos. Superar estos desaf√≠os es clave para desbloquear un futuro energ√©tico m√°s resiliente y sostenible.
                </p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                    <h3 class="text-xl font-bold text-red-600 mb-4 flex items-center"><span class="text-2xl mr-3">‚ö†Ô∏è</span>Desaf√≠os Actuales</h3>
                    <ul class="space-y-3 text-slate-600">
                        <li class="flex">
                            <span class="mr-3 mt-1 text-red-500">üå°Ô∏è</span>
                            <div><strong class="text-slate-700">Gesti√≥n T√©rmica:</strong> La conmutaci√≥n de alta potencia genera calor, lo que puede degradar los componentes y reducir la eficiencia. Se necesitan soluciones de refrigeraci√≥n avanzadas.</div>
                        </li>
                         <li class="flex">
                            <span class="mr-3 mt-1 text-red-500">üìâ</span>
                            <div><strong class="text-slate-700">Degradaci√≥n de Materiales:</strong> Los ciclos r√°pidos y las altas corrientes estresan los semiconductores y las bater√≠as, afectando su vida √∫til.</div>
                        </li>
                         <li class="flex">
                            <span class="mr-3 mt-1 text-red-500">‚ö°</span>
                            <div><strong class="text-slate-700">Eficiencia de Pulso:</strong> Minimizar las p√©rdidas durante transferencias de energ√≠a de muy corta duraci√≥n y alto voltaje es un reto complejo.</div>
                        </li>
                         <li class="flex">
                            <span class="mr-3 mt-1 text-red-500">üîí</span>
                             <div><strong class="text-slate-700">Seguridad:</strong> Manejar "picos masivos de voltaje/energ√≠a" requiere robustos sistemas de protecci√≥n para evitar fallos y garantizar la seguridad.</div>
                        </li>
                    </ul>
                </div>
                 <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                    <h3 class="text-xl font-bold text-green-600 mb-4 flex items-center"><span class="text-2xl mr-3">üöÄ</span>Oportunidades y Futuro</h3>
                     <ul class="space-y-3 text-slate-600">
                        <li class="flex">
                            <span class="mr-3 mt-1 text-green-500">üåê</span>
                            <div><strong class="text-slate-700">Estabilidad de la Red:</strong> Las IPUs pueden proporcionar servicios auxiliares r√°pidos (control de frecuencia/voltaje), mejorando la resiliencia de la red el√©ctrica.</div>
                        </li>
                         <li class="flex">
                            <span class="mr-3 mt-1 text-green-500">üíé</span>
                            <div><strong class="text-slate-700">Nuevos Semiconductores (WBG):</strong> Materiales como SiC y GaN prometen mayores eficiencias, velocidades de conmutaci√≥n y tolerancia a la temperatura.</div>
                        </li>
                         <li class="flex">
                            <span class="mr-3 mt-1 text-green-500">ü§ñ</span>
                            <div><strong class="text-slate-700">Integraci√≥n de IA/ML:</strong> El aprendizaje autom√°tico puede optimizar el control de la IPU de forma predictiva, mejorando el rendimiento y la detecci√≥n de fallos.</div>
                        </li>
                         <li class="flex">
                            <span class="mr-3 mt-1 text-green-500">üß©</span>
                            <div><strong class="text-slate-700">Dise√±o Modular:</strong> Las arquitecturas modulares y escalables facilitar√°n la implementaci√≥n de IPUs en sistemas de todos los tama√±os, desde residenciales hasta industriales.</div>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-slate-800 text-slate-300 mt-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 text-center text-sm">
            <p>Panel Interactivo de la Unidad de Potencia Inteligente (IPU).</p>
            <p>Contenido basado en el informe t√©cnico sobre componentes para sistemas fotovoltaicos.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            const navLinks = document.querySelectorAll('.nav-link');
            const mobileNavLinks = document.querySelectorAll('.nav-link-mobile');
            const contentSections = document.querySelectorAll('.content-section');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            function setActiveLink(targetId) {
                navLinks.forEach(link => {
                    link.classList.toggle('active', link.getAttribute('href') === `#${targetId}`);
                });
                mobileNavLinks.forEach(link => {
                    link.classList.toggle('bg-teal-50', link.getAttribute('href') === `#${targetId}`);
                });
            }

            function showSection(targetId) {
                contentSections.forEach(section => {
                    section.classList.toggle('active', section.id === targetId);
                });
                setActiveLink(targetId);
                 window.scrollTo({ top: 0, behavior: 'smooth' });
            }
            
            function handleNavClick(e) {
                e.preventDefault();
                const targetId = e.currentTarget.getAttribute('href').substring(1);
                showSection(targetId);
                if(mobileMenu.classList.contains('hidden') === false){
                    mobileMenu.classList.add('hidden');
                }
            }

            navLinks.forEach(link => link.addEventListener('click', handleNavClick));
            mobileNavLinks.forEach(link => link.addEventListener('click', handleNavClick));
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });


            const componentData = {
                inversor: {
                    details: '<strong>Funci√≥n:</strong> Convierte la energ√≠a CC de los paneles a CA para el hogar/red.<br><strong>Caracter√≠sticas:</strong> Incluye MPPT, monitoreo y funciones de seguridad. Es el "coraz√≥n" del sistema fotovoltaico.',
                    efficiency: 98
                },
                controlador: {
                    details: '<strong>Funci√≥n:</strong> Protege la bater√≠a contra sobrecargas y descargas profundas.<br><strong>Caracter√≠sticas:</strong> Utiliza PWM o MPPT para optimizar la carga. Esencial para la vida √∫til de la bater√≠a.',
                    efficiency: 99 
                },
                convertidor: {
                    details: '<strong>Funci√≥n:</strong> Eleva (boost) o reduce (buck) el voltaje de CC.<br><strong>Caracter√≠sticas:</strong> Clave para los algoritmos MPPT y para acondicionar la potencia para diferentes componentes.',
                    efficiency: 97 
                }
            };

            const componentBtns = document.querySelectorAll('.component-btn');
            const componentDetailsDiv = document.getElementById('component-details');
            let efficiencyChart;

            function updateComponentView(componentKey) {
                componentBtns.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.component === componentKey);
                });
                const data = componentData[componentKey];
                componentDetailsDiv.innerHTML = data.details;

                if (efficiencyChart) {
                    efficiencyChart.data.datasets[0].data = [data.efficiency];
                    efficiencyChart.data.labels = [componentKey.charAt(0).toUpperCase() + componentKey.slice(1)];
                    efficiencyChart.update();
                }
            }

            function createEfficiencyChart() {
                const ctx = document.getElementById('efficiencyChart').getContext('2d');
                efficiencyChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Eficiencia T√≠pica (%)',
                            data: [],
                            backgroundColor: ['#f59e0b'],
                            borderColor: ['#d97706'],
                            borderWidth: 1,
                            barThickness: 50,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        scales: {
                            x: {
                                beginAtZero: false,
                                min: 85,
                                max: 100,
                                grid: {
                                    color: '#e2e8f0'
                                },
                                ticks: {
                                    color: '#475569'
                                }
                            },
                             y: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: '#475569',
                                    font: {
                                        weight: 'bold'
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'Comparaci√≥n de Eficiencia',
                                color: '#334155',
                                font: {
                                    size: 16
                                }
                            }
                        }
                    }
                });
            }

            componentBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    updateComponentView(btn.dataset.component);
                });
            });


            const batteryData = {
                labels: ['LiFePO4', 'I√≥n-Sodio', 'Plomo-√Åcido', 'Flujo'],
                datasets: [
                    {
                        label: 'Densidad de Energ√≠a (Wh/kg)',
                        data: [175, 150, 40, 28],
                        backgroundColor: '#0d9488', 
                    },
                    {
                        label: 'Ciclos de Vida',
                        data: [4500, 2000, 650, 12500],
                        backgroundColor: '#f59e0b',
                    },
                    {
                        label: 'Eficiencia (%)',
                        data: [92, 90, 80, 78],
                        backgroundColor: '#0ea5e9',
                    }
                ],
                details: [
                    {
                        title: 'Fosfato de Hierro y Litio (LiFePO4)',
                        text: 'La opci√≥n m√°s equilibrada y segura para aplicaciones exigentes. Ideal para la IPU por su alta eficiencia, larga vida √∫til, alta profundidad de descarga (DOD) y seguridad inherente. Aunque su costo inicial es mayor, su bajo costo por ciclo la hace econ√≥micamente viable a largo plazo.',
                        suitability: 'Alta'
                    },
                    {
                        title: 'I√≥n-Sodio (Na-ion)',
                        text: 'Tecnolog√≠a emergente y de bajo costo. Ofrece buena eficiencia pero menor densidad de energ√≠a que el litio. Es una alternativa prometedora para almacenamiento estacionario donde el peso y el espacio no son cr√≠ticos.',
                        suitability: 'Media'
                    },
                    {
                        title: 'Plomo-√Åcido',
                        text: 'Tecnolog√≠a madura y de bajo costo inicial. Sin embargo, sufre de baja densidad de energ√≠a, corta vida √∫til, baja eficiencia y requiere mantenimiento. No es adecuada para los ciclos r√°pidos y profundos que exige una IPU.',
                        suitability: 'Baja'
                    },
                     {
                        title: 'Bater√≠a de Flujo',
                        text: 'Ofrece una vida √∫til excepcionalmente larga y 100% de DOD. Sin embargo, su baja densidad de energ√≠a, baja eficiencia y bajas tasas de carga/descarga la hacen menos adecuada para las r√°fagas de potencia que necesita la IPU.',
                        suitability: 'Media-Baja'
                    }
                ]
            };

            const batteryDetailsDiv = document.getElementById('battery-details');
            let batteryChart;

            function updateBatteryDetails(index) {
                const detail = batteryData.details[index];
                let suitabilityColor = 'text-slate-600';
                if(detail.suitability === 'Alta') suitabilityColor = 'text-green-600';
                if(detail.suitability === 'Media') suitabilityColor = 'text-amber-600';
                if(detail.suitability === 'Baja') suitabilityColor = 'text-red-600';
                
                batteryDetailsDiv.innerHTML = `
                    <h4 class="font-bold text-lg text-slate-800 mb-2">${detail.title}</h4>
                    <p class="text-sm text-slate-600 mb-3">${detail.text}</p>
                    <div class="text-sm">
                        <span class="font-semibold text-slate-700">Idoneidad para IPU:</span>
                        <span class="font-bold ${suitabilityColor}">${detail.suitability}</span>
                    </div>
                `;
            }

            function createBatteryChart() {
                const ctx = document.getElementById('batteryChart').getContext('2d');
                batteryChart = new Chart(ctx, {
                    type: 'bar',
                    data: batteryData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { 
                                beginAtZero: true,
                                grid: { color: '#e2e8f0' },
                                ticks: { color: '#475569' }
                            },
                             x: {
                                grid: { display: false },
                                ticks: { 
                                    color: '#475569',
                                    callback: function(value, index, values) {
                                        const label = this.getLabelForValue(value);
                                        return label.length > 16 ? label.substring(0, 15) + '...' : label;
                                    }
                                }
                             }
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: '#475569'
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            },
                             title: {
                                display: true,
                                text: 'Haga clic en una barra para ver detalles',
                                color: '#475569',
                                font: {
                                    style: 'italic'
                                }
                            }
                        },
                        onClick: (event, elements) => {
                            if (elements.length > 0) {
                                const index = elements[0].index;
                                updateBatteryDetails(index);
                            }
                        }
                    }
                });
            }

            const tooltipEl = document.getElementById('tooltip');
            document.querySelectorAll('.diagram-block').forEach(block => {
                block.addEventListener('mouseenter', e => {
                    const tooltipText = e.target.dataset.tooltip;
                    tooltipEl.textContent = tooltipText;
                    tooltipEl.style.display = 'block';
                    const rect = e.target.getBoundingClientRect();
                    tooltipEl.style.left = `${rect.left + window.scrollX}px`;
                    tooltipEl.style.top = `${rect.top + window.scrollY - tooltipEl.offsetHeight - 5}px`;
                });
                block.addEventListener('mouseleave', () => {
                    tooltipEl.style.display = 'none';
                });
            });

            function runPistonAnimation() {
                const capacitorBar = document.getElementById('capacitor-bar');
                const inductorFlow = document.getElementById('inductor-flow');
                const kickbackSpark = document.getElementById('kickback-spark');
                
                let charging = true;

                setInterval(() => {
                    if (charging) {
                        capacitorBar.style.width = '100%';
                        capacitorBar.textContent = 'CARGADO';
                        inductorFlow.style.width = '100%';
                        kickbackSpark.style.opacity = '0';
                    } else {
                        capacitorBar.style.width = '0%';
                        capacitorBar.textContent = '';
                        inductorFlow.style.width = '0%';
                        kickbackSpark.style.opacity = '1';
                    }
                    charging = !charging;
                }, 2500);
            }
            
            showSection('inicio');
            createEfficiencyChart();
            updateComponentView('inversor');
            createBatteryChart();
            updateBatteryDetails(0);
            runPistonAnimation();

        });
    </script>
</body>
</html>
