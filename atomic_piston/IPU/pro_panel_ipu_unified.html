<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel Interactivo: Unidad de Potencia Inteligente (IPU)</title>

    <!-- Tailwind & Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300..800&family=JetBrains+Mono:wght@400..600&display=swap" rel="stylesheet" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Tailwind config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'atomic-blue': '#38BDF8',
                        'energy-amber': '#FBBF24',
                        'plasma-purple': '#A78BFA',
                        'quantum-teal': '#2DD4BF',
                        'dark-matter': '#0B0F19',
                        'neutrino-gray': '#A0AEC0',
                        'fusion-red': '#F47174',
                        'quantum-green': '#10b981'
                    },
                    animation: {
                        'pulse-slow': 'pulse 2.5s cubic-bezier(.4,0,.6,1) infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate'
                    },
                    keyframes: {
                        glow: {
                            '0%': { boxShadow: '0 0 0 0 rgba(45, 212, 191, 0.4)' },
                            '100%': { boxShadow: '0 0 0 10px rgba(45, 212, 191, 0)' }
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    }
                }
            }
        };
    </script>

    <style>
        :root {
            --dark-matter: #0B0F19;
            --slate-900: #1E293B;
            --slate-800: #283447;
            --slate-700: #394B61;
            --slate-400: #A0AEC0;
            --slate-300: #CBD5E1;
            --slate-200: #E2E8F0;
            --atomic-blue: #38BDF8;
            --quantum-teal: #2DD4BF;
            --energy-amber: #FBBF24;
            --fusion-red: #F47174;
            --plasma-purple: #A78BFA;
            --neutral-white: #FFFFFF;
        }

        ::selection {
            background-color: var(--atomic-blue);
            color: var(--dark-matter);
        }

        body {
            background-color: var(--dark-matter);
            color: var(--slate-200);
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .quantum-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.2), rgba(11, 15, 25, 0.4));
            backdrop-filter: blur(12px);
            border: 1px solid var(--slate-800);
            border-radius: 1.25rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .quantum-card:hover {
            transform: translateY(-6px) scale(1.03);
            box-shadow: 0 25px 30px -10px rgba(0, 0, 0, 0.3), 0 12px 15px -8px rgba(0, 0, 0, 0.2);
            border-color: var(--atomic-blue);
        }

        .nav-link {
            position: relative;
            transition: color 0.3s ease;
            padding: 0.5rem 0;
            font-weight: 500;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 3px;
            background-color: var(--quantum-teal);
            border-radius: 2px;
            transition: width 0.4s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .nav-link.active,
        .nav-link:hover {
            color: var(--neutral-white);
        }

        .nav-link.active::after,
        .nav-link:hover::after {
            width: 110%;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chart-container {
            position: relative;
            width: 100%;
            min-height: 300px;
        }

        .tooltip {
            position: absolute;
            display: none;
            background-color: var(--slate-800);
            color: var(--slate-200);
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            z-index: 100;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--slate-700);
            pointer-events: none;
            transition: opacity 0.2s ease;
        }

        .piston-chamber {
            position: relative;
            width: 100%;
            height: 220px;
            background: radial-gradient(ellipse at bottom, #1e293b, #0f172a);
            border: 1px solid var(--slate-700);
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5), 0 0 15px rgba(14, 165, 233, 0.1);
        }

        .piston-rod {
            position: absolute;
            width: 22px;
            height: 120px;
            background: linear-gradient(to right, #d1d5db, #9ca3af);
            left: 50%;
            transform: translateX(-50%);
            top: 0;
            z-index: 2;
            border-radius: 6px;
            box-shadow: 0 0 12px rgba(245, 158, 11, 0.4);
            transition: top 1.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .piston-head {
            position: absolute;
            width: 90px;
            height: 35px;
            background: linear-gradient(145deg, var(--energy-amber), #fbbf24);
            left: 50%;
            transform: translateX(-50%);
            border-radius: 0.5rem;
            z-index: 3;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.6), inset 0 2px 2px rgba(255,255,255,0.2);
            transition: top 1.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .capacitor-charge {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top, hsla(199, 89%, 50%, 0.8), hsla(199, 89%, 50%, 0));
            transition: height 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            filter: blur(5px);
        }

        .magnetic-field {
            position: absolute;
            width: 150%;
            height: 150%;
            top: -25%;
            left: -25%;
            border-radius: 50%;
            border: 3px dashed hsla(262, 83%, 68%, 0);
            opacity: 0;
            transition: all 0.5s ease-out;
            animation: rotate 10s linear infinite;
        }

        .magnetic-field.active {
            opacity: 1;
            border-color: hsla(262, 83%, 68%, 0.5);
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .spark {
            position: absolute;
            width: 6px;
            height: 60px;
            background: white;
            top: 50%;
            left: 50%;
            transform-origin: center;
            opacity: 0;
            box-shadow: 0 0 30px 10px white, 0 0 50px 20px var(--energy-amber), 0 0 70px 30px var(--fusion-red);
            z-index: 4;
            transition: opacity 0.1s ease;
        }

        .energy-wave {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: radial-gradient(circle, hsla(40, 93%, 58%, 0.5) 0%, transparent 70%);
            opacity: 0;
            transform: scale(0);
            transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .energy-meter {
            position: relative;
            height: 24px;
            background-color: var(--slate-800);
            border-radius: 12px;
            overflow: hidden;
            margin-top: 1.5rem;
            border: 1px solid var(--slate-700);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }

        .energy-level {
            height: 100%;
            background: linear-gradient(90deg, var(--atomic-blue), var(--plasma-purple));
            width: 0%;
            transition: width 0.5s ease-out;
            border-radius: 12px;
            box-shadow: 0 0 10px var(--atomic-blue), 0 0 20px var(--plasma-purple);
        }

        .component-btn.active {
            background-color: var(--quantum-teal) !important;
            color: var(--neutral-white) !importan
        }
    </style>
</head>

<body class="antialiased">

    <header class="bg-dark-matter/80 backdrop-blur-xl sticky top-0 z-50 border-b border-slate-800">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-quantum-teal to-atomic-blue flex items-center justify-center shadow-lg">
                        <i class="fas fa-atom text-neutral-white text-2xl"></i>
                    </div>
                    <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-quantum-teal to-atomic-blue">
                        Unidad de Potencia Inteligente (IPU)
                    </h1>
                </div>

                <nav class="hidden md:flex space-x-8">
                    <a href="#inicio" class="nav-link text-slate-300 active">Inicio</a>
                    <a href="#ipu" class="nav-link text-slate-300">El Núcleo: IPU</a>
                    <a href="#componentes" class="nav-link text-slate-300">Componentes</a>
                    <a href="#baterias-avanzadas" class="nav-link text-slate-300">Baterías</a>
                    <a href="#flujo-energia-avanzado" class="nav-link text-slate-300">Flujo Avanzado</a>
                    <a href="#desafios" class="nav-link text-slate-300">Futuro</a>
                </nav>

                <button id="mobile-menu-button" class="md:hidden p-2 rounded-md text-slate-300 hover:text-neutral-white hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-atomic-blue">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>

            <div id="mobile-menu" class="hidden md:hidden pb-4 space-y-1">
                <a href="#inicio" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-slate-300 hover:bg-slate-700">Inicio</a>
                <a href="#ipu" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-slate-300 hover:bg-slate-700">El Núcleo: IPU</a>
                <a href="#componentes" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-slate-300 hover:bg-slate-700">Componentes</a>
                <a href="#baterias-avanzadas" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-slate-300 hover:bg-slate-700">Baterías</a>
                <a href="#flujo-energia-avanzado" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-slate-300 hover:bg-slate-700">Flujo Avanzado</a>
                <a href="#desafios" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-slate-300 hover:bg-slate-700">Futuro</a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16">

        <!-- Inicio -->
        <section id="inicio" class="content-section active">
            <div class="text-center mb-16">
                <div class="inline-block p-4 rounded-full bg-slate-800 mb-6 shadow-lg">
                    <div class="w-20 h-20 rounded-full bg-gradient-to-br from-energy-amber to-fusion-red flex items-center justify-center">
                        <i class="fas fa-bolt text-neutral-white text-3xl"></i>
                    </div>
                </div>
                <h2 class="text-4xl md:text-5xl font-extrabold text-neutral-white mb-5">
                    Transformando la Energía Solar con Inteligencia
                </h2>
                <p class="max-w-3xl mx-auto text-lg text-slate-300 leading-relaxed">
                    Explora la Unidad de Potencia Inteligente (IPU), un sistema que revoluciona la gestión de energía en instalaciones fotovoltaicas mediante electrónica de potencia, microcontroladores y baterías avanzadas.
                </p>
            </div>

            <div class="quantum-card p-8 md:p-10">
                <h3 class="text-3xl font-bold text-center text-transparent bg-clip-text bg-gradient-to-r from-quantum-teal to-atomic-blue mb-8">
                    Flujo de Energía en un Sistema Fotovoltaico Moderno
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-5 items-center gap-6 text-center">
                    <div class="flex flex-col items-center">
                        <div class="w-20 h-20 rounded-full bg-slate-800 flex items-center justify-center mb-4 glow">
                            <i class="fas fa-sun text-energy-amber text-3xl"></i>
                        </div>
                        <h4 class="font-semibold text-slate-200 text-lg">Paneles Solares</h4>
                        <p class="text-sm text-slate-400">Generan energía CC</p>
                    </div>
                    <div class="text-4xl text-slate-600 md:transform-none transform rotate-90">
                        <i class="fas fa-long-arrow-alt-right"></i>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="w-24 h-24 rounded-full bg-gradient-to-br from-quantum-teal to-atomic-blue flex items-center justify-center mb-4 glow">
                            <i class="fas fa-microchip text-neutral-white text-4xl"></i>
                        </div>
                        <h4 class="font-semibold text-slate-200 text-lg">IPU</h4>
                        <p class="text-sm text-slate-400">Gestiona & optimiza</p>
                    </div>
                    <div class="text-4xl text-slate-600 md:transform-none transform rotate-90">
                        <i class="fas fa-long-arrow-alt-right"></i>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="w-20 h-20 rounded-full bg-slate-800 flex items-center justify-center mb-4 glow">
                            <i class="fas fa-home text-atomic-blue text-3xl"></i>
                        </div>
                        <h4 class="font-semibold text-slate-200 text-lg">Hogar & Red</h4>
                        <p class="text-sm text-slate-400">Consumo CA</p>
                    </div>
                </div>
                <p class="mt-10 text-center text-slate-400 max-w-4xl mx-auto leading-relaxed">
                    La IPU actúa como el corazón y cerebro: convierte, almacena y raciona la energía para maximizar la eficiencia (hasta 98 %) y estabilizar la red.
                </p>
            </div>
        </section>

        <!-- El Núcleo -->
        <section id="ipu" class="content-section">
            <div class="text-center mb-16">
                <div class="inline-block p-4 rounded-full bg-slate-800 mb-6 shadow-lg">
                    <div class="w-20 h-20 rounded-full bg-gradient-to-br from-atomic-blue to-plasma-purple flex items-center justify-center">
                        <i class="fas fa-atom text-neutral-white text-3xl"></i>
                    </div>
                </div>
                <h2 class="text-4xl md:text-5xl font-extrabold text-neutral-white mb-5">
                    El Núcleo: Unidad de Potencia Inteligente (IPU)
                </h2>
                <p class="max-w-3xl mx-auto text-lg text-slate-300 leading-relaxed">
                    Inspirado en el “pistón”, la IPU almacena y libera energía en pulsos rápidos y potentes gracias a la sinergia de condensadores e inductores.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
                <!-- Diagrama Dinámico -->
                <div class="quantum-card p-6">
                    <h3 class="text-2xl font-bold text-center text-transparent bg-clip-text bg-gradient-to-r from-energy-amber to-fusion-red mb-6">
                        Dinámica del Pistón
                    </h3>
                    <div class="space-y-6">
                        <div class="piston-chamber">
                            <div class="piston-rod" id="piston-rod"></div>
                            <div class="piston-head" id="piston-head"></div>
                            <div class="capacitor-charge" id="capacitor-charge"></div>
                            <div class="inductor-coil">
                                <div class="magnetic-field" id="magnetic-field"></div>
                            </div>
                            <div class="spark" id="spark"></div>
                            <div class="energy-wave" id="energy-wave"></div>
                        </div>

                        <div class="energy-meter">
                            <div class="energy-level" id="energy-level"></div>
                        </div>
                        <div class="meter-labels flex justify-between text-xs text-slate-400">
                            <span>0 V</span><span>250 V</span><span>500 V</span><span>750 V</span><span>1000 V</span>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mt-4 text-sm">
                            <div class="bg-slate-800/50 p-4 rounded-lg">
                                <h4 class="font-semibold text-slate-200 mb-2">Estado del Capacitor</h4>
                                <div id="capacitor-state" class="font-mono text-atomic-blue">Cargando...</div>
                            </div>
                            <div class="bg-slate-800/50 p-4 rounded-lg">
                                <h4 class="font-semibold text-slate-200 mb-2">Campo Magnético</h4>
                                <div id="magnetic-state" class="font-mono text-plasma-purple">Inactivo</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Arquitectura -->
                <div class="quantum-card p-6">
                    <h3 class="text-2xl font-bold text-center text-transparent bg-clip-text bg-gradient-to-r from-quantum-teal to-atomic-blue mb-6">
                        Arquitectura de la IPU
                    </h3>
                    <p class="text-sm text-slate-400 mb-6 text-center">
                        Interactúa con cada bloque para conocer su función.
                    </p>
                    <div class="grid grid-cols-3 gap-4 text-center text-sm font-medium">
                        <div class="col-span-3 diagram-block bg-energy-amber/10 text-energy-amber p-4 rounded-lg border border-energy-amber/20 hover:bg-energy-amber/20" data-tooltip="Fuente de energía primaria que genera corriente continua a partir de la luz solar.">
                            <i class="fas fa-sun mr-2"></i>Paneles Solares
                        </div>
                        <div class="col-span-3 flex justify-center items-center">
                            <i class="fas fa-arrow-down text-slate-600"></i>
                        </div>

                        <div class="col-span-3 diagram-block bg-atomic-blue/10 text-atomic-blue p-4 rounded-lg border border-atomic-blue/20 hover:bg-atomic-blue/20" data-tooltip="Optimiza la energía (MPPT) y regula el voltaje para su almacenamiento y uso.">
                            <i class="fas fa-exchange-alt mr-2"></i>Convertidor CC-CC
                        </div>
                        <div class="col-span-3 flex justify-center items-center">
                            <i class="fas fa-arrow-down text-slate-600"></i>
                        </div>

                        <div class="diagram-block bg-quantum-teal/10 text-quantum-teal p-3 rounded-lg border border-quantum-teal/20 hover:bg-quantum-teal/20" data-tooltip="Almacena grandes cantidades de energía a largo plazo.">
                            <i class="fas fa-battery-full mr-2"></i>Batería
                        </div>
                        <div class="diagram-block bg-slate-500/10 text-slate-300 p-3 rounded-lg border border-slate-500/20 hover:bg-slate-500/20" data-tooltip="El cerebro: ejecuta algoritmos y gestiona la comunicación.">
                            <i class="fas fa-microchip mr-2"></i>MCU
                        </div>
                        <div class="diagram-block bg-plasma-purple/10 text-plasma-purple p-3 rounded-lg border border-plasma-purple/20 hover:bg-plasma-purple/20" data-tooltip="Almacena y libera energía rápidamente para pulsos de alta potencia.">
                            <i class="fas fa-bolt mr-2"></i>P. Pulsada
                        </div>

                        <div class="col-span-3 flex justify-center items-center">
                            <i class="fas fa-arrow-down text-slate-600"></i>
                        </div>
                        <div class="col-span-3 diagram-block bg-fusion-red/10 text-fusion-red p-4 rounded-lg border border-fusion-red/20 hover:bg-fusion-red/20" data-tooltip="Convierte CC a CA para uso doméstico o inyección a la red.">
                            <i class="fas fa-plug mr-2"></i>Inversor / Carga
                        </div>
                    </div>
                </div>
            </div>
            <div id="tooltip" class="tooltip"></div>
        </section>

        <!-- Componentes -->
        <section id="componentes" class="content-section">
            <div class="text-center mb-16">
                <div class="inline-block p-4 rounded-full bg-slate-800 mb-6 shadow-lg">
                    <div class="w-20 h-20 rounded-full bg-gradient-to-br from-plasma-purple to-pink-500 flex items-center justify-center">
                        <i class="fas fa-cogs text-neutral-white text-3xl"></i>
                    </div>
                </div>
                <h2 class="text-4xl md:text-5xl font-extrabold text-neutral-white mb-5">
                    Componentes Clave de la IPU
                </h2>
                <p class="max-w-3xl mx-auto text-lg text-slate-300 leading-relaxed">
                    La IPU integra gestión de potencia, control inteligente y almacenamiento eficiente para maximizar el rendimiento.
                p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Gestión de Potencia -->
                <div class="quantum-card p-8">
                    <h3 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-quantum-teal to-atomic-blue mb-5">
                        Gestión de Potencia: El Músculo
                    </h3>
                    <p class="text-slate-400 mb-6">
                        Estos componentes manejan el flujo de energía; su eficiencia es crítica para minimizar pérdidas.
                    </p>
                    <div class="flex flex-wrap gap-3 mb-6">
                        <button class="component-btn bg-slate-800 px-4 py-2 rounded-full text-sm font-semibold border border-slate-700 hover:bg-quantum-teal hover:text-neutral-white hover:border-quantum-teal transition-all" data-component="inversor">Inversores</button>
                        <button class="component-btn bg-slate-800 px-4 py-2 rounded-full text-sm font-semibold border border-slate-700 hover:bg-quantum-teal hover:text-neutral-white hover:border-quantum-teal transition-all" data-component="controlador">Controladores</button>
                        <button class="component-btn bg-slate-800 px-4 py-2 rounded-full text-sm font-semibold border border-slate-700 hover:bg-quantum-teal hover:text-neutral-white hover:border-quantum-teal transition-all" data-component="convertidor">Convertidores</button>
                    </div>
                    <div id="component-details" class="bg-slate-800/50 p-5 rounded-lg mb-6 text-sm text-slate-300"></div>
                    <div class="chart-container h-64">
                        <canvas id="efficiencyChart"></canvas>
                    </div>
                </div>

                <!-- Control Inteligente -->
                <div class="quantum-card p-8">
                    <h3 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-energy-amber to-fusion-red mb-5">
                        Control Inteligente: El Cerebro
                    </h3>
                    <p class="text-slate-400 mb-6">
                        El ESP32 ejecuta algoritmos complejos y mantiene comunicación remota.
                    </p>
                    <div class="bg-slate-800/50 p-5 rounded-lg space-y-4 text-sm">
                        <h4 class="font-bold text-slate-200 text-base">ESP32: Capacidades Clave</h4>
                        <ul class="grid grid-cols-2 gap-x-6 gap-y-2 text-slate-300">
                            <li class="flex items-center"><i class="fas fa-microchip text-quantum-teal mr-3"></i>CPU Dual-Core @ 240 MHz</li>
                            <li class="flex items-center"><i class="fas fa-wifi text-quantum-teal mr-3"></i>Wi-Fi + Bluetooth</li>
                            <li class="flex items-center"><i class="fas fa-sitemap text-quantum-teal mr-3"></i>34 GPIOs</li>
                            <li class="flex items-center"><i class="fas fa-bolt text-quantum-teal mr-3"></i>Bajo consumo</li>
                            <li class="flex items-center"><i class="fas fa-shield-alt text-quantum-teal mr-3"></i>Seguridad HW</li>
                            <li class="flex items-center"><i class="fas fa-chart-line text-quantum-teal mr-3"></i>ADC 12-bit</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Almacenamiento -->
            <div class="quantum-card p-8 md:p-10">
                <h3 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-atomic-blue to-plasma-purple mb-4 text-center">
                    Almacenamiento de Energía: La Reserva
                </h3>
                <p class="text-slate-400 mb-8 text-center max-w-3xl mx-auto leading-relaxed">
                    Haz clic en una barra para explorar cada tecnología.
                </p>
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-8 items-center">
                    <div class="lg:col-span-3">
                        <div class="chart-container">
                            <canvas id="batteryChart"></canvas>
                        </div>
                    </div>
                    <div id="battery-details" class="lg:col-span-2 bg-slate-800/50 p-6 rounded-lg min-h-[220px]"></div>
                </div>
            </div>
        </section>

        <!-- Baterías Avanzadas -->
        <section id="baterias-avanzadas" class="content-section">
            <div class="text-center mb-16">
                <div class="inline-block p-4 rounded-full bg-slate-800 mb-6 shadow-lg">
                    <div class="w-20 h-20 rounded-full bg-gradient-to-br from-quantum-teal to-green-500 flex items-center justify-center">
                        <i class="fas fa-battery-full text-neutral-white text-3xl"></i>
                    </div>
                </div>
                <h2 class="text-4xl md:text-5xl font-extrabold text-neutral-white mb-5">
                    Baterías Avanzadas y su Impacto en el Pistón
                </h2>
                <p class="max-w-3xl mx-auto text-lg text-slate-300 leading-relaxed">
                    La vida útil de una batería depende de la profundidad de descarga y la química. Aquí se compara.
                </p>
            </div>
            <div class="quantum-card p-8 md:p-10">
                <h3 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-quantum-teal to-atomic-blue mb-6 text-center">
                    Vida Útil vs. Profundidad de Descarga
                </h3>
                <div class="chart-container h-[450px]">
                    <canvas id="cycleLifeChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Flujo Avanzado -->
        <section id="flujo-energia-avanzado" class="content-section">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-extrabold text-neutral-white mb-5">
                    Componentes Sofisticados para el Flujo de Energía
                </h2>
                <p class="max-w-3xl mx-auto text-lg text-slate-300 leading-relaxed">
                    Evolución de componentes estándar a avanzados para mayor precisión y eficiencia.
                </p>
            </div>
            <div class="quantum-card p-8 md:p-10">
                <h3 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-quantum-teal to-atomic-blue mb-6 text-center">
                    Comparativa: Estándar vs. Avanzado
                </h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full text-left table-fixed">
                        <thead>
                            <tr class="border-b-2 border-slate-700">
                                <th class="py-4 px-5 text-sm font-semibold text-slate-200 w-1/3">Característica</th>
                                <th class="py-4 px-5 text-sm font-semibold text-slate-200 w-1/3">Estándar (MVP)</th>
                                <th class="py-4 px-5 text-sm font-semibold text-slate-200 w-1/3">Avanzado (Escalabilidad)</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm text-slate-300">
                            <tr class="border-b border-slate-800">
                                <td class="py-4 px-5 font-semibold">Eficiencia</td>
                                <td class="py-4 px-5">Hasta 98 %</td>
                                <td class="py-4 px-5 font-semibold text-quantum-teal">98–99 %+ (SiC/GaN)</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-4 px-5 font-semibold">Bidireccional</td>
                                <td class="py-4 px-5">Limitado</td>
                                <td class="py-4 px-5 font-semibold text-quantum-teal">Total</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-4 px-5 font-semibold">Frecuencia</td>
                                <td class="py-4 px-5">Baja/moderada</td>
                                <td class="py-4 px-5 font-semibold text-quantum-teal">Alta (kHz)</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-4 px-5 font-semibold">Costo/Beneficio</td>
                                <td class="py-4 px-5"><span class="font-bold text-green-400">Alto</span></td>
                                <td class="py-4 px-5"><span class="font-bold text-energy-amber">Moderado</span></td>
                            </tr>
                            <tr>
                                <td class="py-4 px-5 font-semibold">Disponibilidad</td>
                                <td class="py-4 px-5"><span class="font-bold text-green-400">Fácil</span></td>
                                <td class="py-4 px-5"><span class="font-bold text-energy-amber">Moderada</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Desafíos y Futuro -->
        <section id="desafios" class="content-section">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-extrabold text-neutral-white mb-5">
                    Desafíos y Oportunidades Futuras
                </h2>
                <p class="max-w-3xl mx-auto text-lg text-slate-300 leading-relaxed">
                    La IPU enfrenta retos técnicos, pero su potencial para transformar el sistema energético es enorme.
                </p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="quantum-card p-8">
                    <h3 class="text-2xl font-bold text-fusion-red mb-5 flex items-center">
                        <i class="fas fa-exclamation-triangle mr-3"></i>Desafíos
                    </h3>
                    <ul class="space-y-4 text-slate-300">
                        <li class="flex items-start"><i class="fas fa-thermometer-half text-fusion-red mr-3 mt-1"></i><span><strong>Gestión térmica:</strong> Disipar el calor generado por la conmutación de alta potencia.</span></li>
                        <li class="flex items-start"><i class="fas fa-cogs text-fusion-red mr-3 mt-1"></i><span><strong>Degradación:</strong> El estrés de los ciclos rápidos puede acortar la vida útil de los componentes.</span></li>
                        <li class="flex items-start"><i class="fas fa-bolt text-fusion-red mr-3 mt-1"></i><span><strong>Eficiencia de pulso:</strong> Minimizar las pérdidas durante la transferencia de energía en microsegundos.</span></li>
                        <li class="flex items-start"><i class="fas fa-shield-alt text-fusion-red mr-3 mt-1"></i><span><strong>Seguridad:</strong> Implementar protecciones robustas contra picos de voltaje y corriente masivos.</span></li>
                    </ul>
                </div>
                <div class="quantum-card p-8">
                    <h3 class="text-2xl font-bold text-quantum-teal mb-5 flex items-center">
                        <i class="fas fa-rocket mr-3"></i>Oportunidades
                    </h3>
                    <ul class="space-y-4 text-slate-300">
                        <li class="flex items-start"><i class="fas fa-network-wired text-quantum-teal mr-3 mt-1"></i><span>Ofrecer servicios auxiliares a la red, como la regulación de frecuencia y voltaje.</span></li>
                        <li class="flex items-start"><i class="fas fa-gem text-quantum-teal mr-3 mt-1"></i><span>Adoptar semiconductores de banda ancha (SiC/GaN) para mayor eficiencia y densidad de potencia.</span></li>
                        <li class="flex items-start"><i class="fas fa-brain text-quantum-teal mr-3 mt-1"></i><span>Utilizar IA y ML para un control predictivo y adaptativo del flujo de energía.</span></li>
                        <li class="flex items-start"><i class="fas fa-puzzle-piece text-quantum-teal mr-3 mt-1"></i><span>Desarrollar un diseño modular que permita la escalabilidad y fácil mantenimiento.</span></li>
                    </ul>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-dark-matter text-slate-400 mt-16 border-t border-slate-800">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-sm">
            <p>Panel Interactivo de la Unidad de Potencia Inteligente (IPU).</p>
            <p class="text-slate-500">Basado en el informe técnico de componentes para sistemas fotovoltaicos.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const data = {
                "componentData": {
                    "inversor": {
                        "details": "<strong>Función:</strong> Convierte CC a CA.<br><strong>Eficiencia:</strong> Hasta 98 %.",
                        "efficiency": 98
                    },
                    "controlador": {
                        "details": "<strong>Función:</strong> Protege la batería.<br><strong>Eficiencia:</strong> Hasta 99 %.",
                        "efficiency": 99
                    },
                    "convertidor": {
                        "details": "<strong>Función:</strong> Ajusta voltaje CC.<br><strong>Eficiencia:</strong> Hasta 97 %.",
                        "efficiency": 97
                    }
                },
                "batteryData": {
                    "labels": ["LiFePO4", "NMC", "LTO", "Ión-Sodio", "Plomo-Ácido", "Flujo"],
                    "datasets": [
                        { "label": "Densidad (Wh/kg)", "data": [175, 220, 70, 150, 40, 28], "backgroundColor": "#0d9488" },
                        { "label": "Ciclos", "data": [4500, 1500, 10000, 2000, 650, 12500], "backgroundColor": "#f59e0b" },
                        { "label": "Eficiencia (%)", "data": [92, 90, 95, 90, 80, 78], "backgroundColor": "#0ea5e9" }
                    ],
                    "details": [
                        { "title": "LiFePO4", "text": "Equilibrio ideal: alta seguridad y vida útil." },
                        { "title": "NMC", "text": "Alta densidad, menor estabilidad térmica." },
                        { "title": "LTO", "text": "Ciclos extremadamente largos, carga rápida." },
                        { "title": "Ión-Sodio", "text": "Bajo costo, densidad media." },
                        { "title": "Plomo-Ácido", "text": "Madura y barata, pero corta vida." },
                        { "title": "Flujo", "text": "Durabilidad extrema, baja densidad." }
                    ]
                },
                "cycleData": {
                    "labels": ["20%", "40%", "60%", "80%", "100%"],
                    "datasets": [
                        { "label": "LiFePO4", "data": [10000, 8000, 6000, 4500, 3000], "borderColor": "#2DD4BF", "backgroundColor": "rgba(45, 212, 191, 0.2)", "tension": 0.4, "fill": true },
                        { "label": "NMC", "data": [4000, 3000, 2000, 1500, 1000], "borderColor": "#FBBF24", "backgroundColor": "rgba(251, 191, 36, 0.2)", "tension": 0.4, "fill": true },
                        { "label": "LTO", "data": [25000, 20000, 18000, 15000, 10000], "borderColor": "#38BDF8", "backgroundColor": "rgba(56, 189, 248, 0.2)", "tension": 0.4, "fill": true }
                    ]
                }
            };

            // Chart.js Global Config
            Chart.defaults.color = '#A0AEC0';
            Chart.defaults.font.family = "'Inter', 'sans-serif'";

            /* ---------- Navegación ---------- */
            const navLinks = document.querySelectorAll('.nav-link, .nav-link-mobile');
            const sections = document.querySelectorAll('.content-section');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileBtn = document.getElementById('mobile-menu-button');

            function showSection(id) {
                sections.forEach(s => s.classList.toggle('active', s.id === id));
                navLinks.forEach(l => {
                    const isActive = l.getAttribute('href') === `#${id}`;
                    if (l.classList.contains('nav-link')) {
                        l.classList.toggle('active', isActive);
                    } else {
                        l.classList.toggle('bg-slate-700', isActive);
                    }
                });
                mobileMenu.classList.add('hidden');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            navLinks.forEach(l => l.addEventListener('click', e => {
                e.preventDefault();
                showSection(l.getAttribute('href').slice(1));
            }));
            mobileBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

            /* ---------- Componentes ---------- */
            const { componentData } = data;
            const compBtns = document.querySelectorAll('.component-btn');
            const compDetails = document.getElementById('component-details');
            let effChart;

            function updateCompView(key) {
                compBtns.forEach(b => b.classList.toggle('active', b.dataset.component === key));
                const d = componentData[key];
                compDetails.innerHTML = d.details;
                if (effChart) {
                    effChart.data.datasets[0].data = [d.efficiency, 100 - d.efficiency];
                    effChart.update();

                    // Update center text
                    const centerText = document.getElementById('efficiency-text');
                    if(centerText) centerText.innerHTML = `<div class="text-3xl font-bold text-quantum-teal">${d.efficiency}%</div><div class="text-sm text-slate-400">Eficiencia</div>`;
                }
            }

            function createEffChart() {
                const ctx = document.getElementById('efficiencyChart');
                if (!ctx) return;
                effChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Eficiencia', 'Pérdida'],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                '#2DD4BF',
                                '#394B61'
                            ],
                            borderColor: '#283447',
                            borderWidth: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '80%',
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: false }
                        }
                    }
                });
            }

            compBtns.forEach(b => b.addEventListener('click', () => updateCompView(b.dataset.component)));

            /* ---------- Baterías ---------- */
            const { batteryData } = data;
            const batDet = document.getElementById('battery-details');
            let batChart;

            function updateBatDetails(i) {
                const d = batteryData.details[i];
                batDet.innerHTML = `<h4 class="font-bold text-lg text-slate-200 mb-2">${d.title}</h4><p class="text-sm text-slate-400">${d.text}</p>`;
            }

            function createBatChart() {
                const ctx = document.getElementById('batteryChart');
                if (!ctx) return;
                batChart = new Chart(ctx, {
                    type: 'bar',
                    data: batteryData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        scales: {
                            y: { grid: { color: 'rgba(255,255,255,.05)' } },
                            x: { grid: { color: 'rgba(255,255,255,.05)' } }
                        },
                        plugins: {
                            legend: { position: 'bottom' },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    label: (context) => `${context.dataset.label}: ${context.formattedValue}`
                                }
                            }
                        },
                        onClick: (_, els) => els.length && updateBatDetails(els[0].index)
                    }
                });
            }

            /* ---------- Vida útil vs DoD ---------- */
            const { cycleData } = data;
            function createCycleChart() {
                const ctx = document.getElementById('cycleLifeChart');
                if (!ctx) return;
                new Chart(ctx, {
                    type: 'line',
                    data: cycleData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                title: { display: true, text: 'Profundidad de Descarga (DoD)', font: { size: 14 } },
                                grid: { color: 'rgba(255,255,255,.05)' }
                            },
                            y: {
                                title: { display: true, text: 'Ciclos de Vida', font: { size: 14 } },
                                grid: { color: 'rgba(255,255,255,.05)' }
                            }
                        },
                        plugins: {
                            legend: { position: 'bottom' },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index',
                        }
                    }
                });
            }

            /* ---------- Tooltips ---------- */
            const tooltip = document.getElementById('tooltip');
            document.querySelectorAll('.diagram-block').forEach(block => {
                block.addEventListener('mouseenter', e => {
                    tooltip.textContent = e.target.dataset.tooltip || '';
                    tooltip.style.display = 'block';
                    const r = e.target.getBoundingClientRect();
                    tooltip.style.left = `${r.left}px`;
                    tooltip.style.top = `${r.top - tooltip.offsetHeight - 8}px`;
                });
                block.addEventListener('mouseleave', () => tooltip.style.display = 'none');
            });

            /* ---------- Pistón Animation ---------- */
            const rod = document.getElementById('piston-rod');
            const head = document.getElementById('piston-head');
            const charge = document.getElementById('capacitor-charge');
            const magnetic = document.getElementById('magnetic-field');
            const sparkEl = document.getElementById('spark');
            const wave = document.getElementById('energy-wave');
            const level = document.getElementById('energy-level');
            const capState = document.getElementById('capacitor-state');
            const magState = document.getElementById('magnetic-state');

            let animState = { charge: 0, piston: 0, magnetic: 0, spark: 0, wave: 0, lastTime: 0 };
            const CHARGE_TIME = 2000;
            const DISCHARGE_TIME = 500;
            const PULSE_TIME = 200;

            function runPistonAnimation(timestamp) {
                if (!rod || !document.body.contains(rod)) return;
                const deltaTime = timestamp - (animState.lastTime || timestamp);
                animState.lastTime = timestamp;

                // Charging phase
                if (animState.charge < CHARGE_TIME) {
                    animState.charge += deltaTime;
                    const chargePercent = Math.min(animState.charge / CHARGE_TIME, 1);

                    charge.style.height = `${chargePercent * 100}%`;
                    level.style.width = `${chargePercent * 100}%`;
                    rod.style.top = `${100 - chargePercent * 70}px`;
                    head.style.top = `${170 - chargePercent * 140}px`;

                    capState.textContent = `Cargando... ${(chargePercent * 100).toFixed(0)}%`;
                    magState.textContent = 'Inactivo';
                    magnetic.classList.remove('active');
                    wave.style.opacity = '0';
                    sparkEl.style.opacity = '0';

                } // Discharging phase
                else if (animState.charge < CHARGE_TIME + DISCHARGE_TIME) {
                    animState.charge += deltaTime;
                    const dischargePercent = (animState.charge - CHARGE_TIME) / DISCHARGE_TIME;

                    charge.style.height = `${(1 - dischargePercent) * 100}%`;
                    level.style.width = `${(1 - dischargePercent * 0.5) * 100}%`;

                    magnetic.classList.add('active');
                    magnetic.style.opacity = dischargePercent;
                    magnetic.style.transform = `scale(${dischargePercent}) rotate(${timestamp/10}deg)`;

                    capState.textContent = 'Descargando en Inductor';
                    magState.textContent = 'Campo Magnético Creciendo';

                } // Pulse phase
                else if (animState.charge < CHARGE_TIME + DISCHARGE_TIME + PULSE_TIME) {
                    animState.charge += deltaTime;
                    const pulsePercent = (animState.charge - CHARGE_TIME - DISCHARGE_TIME) / PULSE_TIME;

                    sparkEl.style.opacity = 1 - pulsePercent;
                    sparkEl.style.transform = `translate(-50%, -50%) rotate(${Math.random() * 360}deg) scale(${1 + pulsePercent * 2})`;

                    wave.style.opacity = 1 - pulsePercent;
                    wave.style.transform = `scale(${pulsePercent * 1.5})`;

                    magnetic.classList.remove('active');
                    capState.textContent = '¡PULSO DE POTENCIA!';
                    magState.textContent = 'Descarga Completa';

                } // Reset
                else {
                    animState.charge = 0;
                }

                requestAnimationFrame(runPistonAnimation);
            }

            /* ---------- Init ---------- */
            showSection('inicio');
            createEffChart();
            // Add a div for the efficiency text
            const chartContainer = document.querySelector('#efficiencyChart').parentElement;
            const effText = document.createElement('div');
            effText.id = 'efficiency-text';
            effText.className = 'absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center';
            chartContainer.appendChild(effText);

            updateCompView('inversor');
            createBatChart();
            updateBatDetails(0);
            createCycleChart();
            if (rod) requestAnimationFrame(runPistonAnimation);
        });
    </script>
</body>
</html>
